# 管理后台测试指南

## 测试前准备

### 1. 确保服务运行
```bash
cd backend
npm start
```

应该看到：
```
Doctor service listening on port 4000
```

### 2. 确保数据库连接正常
检查 `backend/server.js` 中的数据库配置：
```javascript
const pool = mysql.createPool({
  host: 'localhost',
  user: 'root',
  password: 'your_password',
  database: 'hospital_appointment',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
});
```

---

## 测试用例

### 测试1：登录功能

#### 步骤
1. 访问 `http://localhost:4000/admin/login.html`
2. 输入用户名：`admin`
3. 输入密码：`Aa121212`
4. 输入验证码（图片中显示的4位字符）
5. 点击"登录"按钮

#### 预期结果
- ✅ 验证码正确：跳转到 `/admin/index.html`
- ❌ 验证码错误：显示"验证码错误"，验证码刷新
- ❌ 用户名或密码错误：显示"用户名或密码错误"

#### 测试点
- [ ] 正确的用户名和密码可以登录
- [ ] 错误的用户名或密码无法登录
- [ ] 验证码错误无法登录
- [ ] 点击验证码图片可以刷新
- [ ] 登录后跳转到管理页面

---

### 测试2：未登录访问管理页面

#### 步骤
1. 清除浏览器缓存或使用无痕模式
2. 直接访问 `http://localhost:4000/admin/index.html`

#### 预期结果
- ✅ 自动跳转到登录页面

#### 测试点
- [ ] 未登录无法访问管理页面
- [ ] 自动跳转到登录页面

---

### 测试3：退出登录

#### 步骤
1. 登录后，点击右上角的"退出登录"按钮
2. 确认退出

#### 预期结果
- ✅ 弹出确认对话框
- ✅ 确认后跳转到登录页面
- ✅ 再次访问管理页面会跳转到登录页面

#### 测试点
- [ ] 退出登录需要确认
- [ ] 退出后跳转到登录页面
- [ ] 退出后无法直接访问管理页面

---

### 测试4：添加医生

#### 步骤
1. 登录后，在"医生基础信息管理"页面
2. 填写表单：
   - 姓名：张医生
   - 头衔：主任医师
   - 所在医院：XX医院
   - 科室：男科
   - 挂号费用：50.00
   - 擅长：前列腺疾病治疗
   - 简介：从事男科临床工作20年
3. 点击"保存"按钮

#### 预期结果
- ✅ 显示"保存成功"提示
- ✅ 表单自动清空
- ✅ 医生列表中显示新添加的医生

#### 测试点
- [ ] 可以成功添加医生
- [ ] 表单验证正常（姓名必填）
- [ ] 保存后表单重置
- [ ] 列表实时更新

---

### 测试5：编辑医生

#### 步骤
1. 在医生列表中点击"编辑"按钮
2. 修改医生信息（如修改挂号费用为60.00）
3. 点击"保存"按钮

#### 预期结果
- ✅ 表单自动填充医生信息
- ✅ 显示"保存成功"提示
- ✅ 列表中的信息已更新

#### 测试点
- [ ] 点击编辑后表单自动填充
- [ ] 可以修改医生信息
- [ ] 修改后列表更新

---

### 测试6：删除医生

#### 步骤
1. 在医生列表中点击"删除"按钮
2. 确认删除

#### 预期结果
- ✅ 弹出确认对话框
- ✅ 确认后医生从列表中移除

#### 测试点
- [ ] 删除需要确认
- [ ] 删除后列表更新
- [ ] 取消删除不会删除医生

---

### 测试7：批量设置号源

#### 前提条件
- 已添加至少一位医生

#### 步骤
1. 点击左侧菜单"医生号源信息管理"
2. 选择医生
3. 选择日期范围（如：2025-12-04 到 2025-12-10）
4. 点击"批量设置号源"按钮
5. 输入上午号源：20
6. 输入下午号源：20
7. 确认

#### 预期结果
- ✅ 显示"批量设置成功"提示
- ✅ 点击"查询号源"可以看到设置的号源

#### 测试点
- [ ] 可以批量设置号源
- [ ] 设置后可以查询到
- [ ] 日期范围计算正确

---

### 测试8：查询号源

#### 前提条件
- 已设置号源

#### 步骤
1. 在"医生号源信息管理"页面
2. 选择医生
3. 选择日期范围
4. 点击"查询号源"按钮

#### 预期结果
- ✅ 显示号源列表表格
- ✅ 包含日期、星期、上午号源、下午号源、总数
- ✅ 星期显示正确（如：星期三）
- ✅ 总数自动计算正确

#### 测试点
- [ ] 可以查询号源
- [ ] 日期范围过滤正确
- [ ] 星期显示正确
- [ ] 总数计算正确

---

### 测试9：修改号源

#### 前提条件
- 已查询出号源列表

#### 步骤
1. 在号源列表中修改某个日期的上午号源（如改为25）
2. 修改某个日期的下午号源（如改为30）
3. 点击"保存修改"按钮

#### 预期结果
- ✅ 显示"保存成功"提示
- ✅ 重新查询后显示修改后的数据

#### 测试点
- [ ] 可以修改号源数量
- [ ] 可以同时修改多个日期
- [ ] 保存后数据更新

---

### 测试10：菜单切换

#### 步骤
1. 点击"医生基础信息管理"菜单
2. 点击"医生号源信息管理"菜单
3. 再次点击"医生基础信息管理"菜单

#### 预期结果
- ✅ 菜单激活状态切换
- ✅ 页面内容切换
- ✅ 切换流畅无闪烁

#### 测试点
- [ ] 菜单可以正常切换
- [ ] 激活状态显示正确
- [ ] 页面内容对应正确

---

### 测试11：表单重置

#### 步骤
1. 在"医生基础信息管理"页面填写表单
2. 点击"重置"按钮

#### 预期结果
- ✅ 表单所有字段清空
- ✅ 头像预览恢复默认

#### 测试点
- [ ] 重置按钮正常工作
- [ ] 所有字段清空
- [ ] 头像预览重置

---

### 测试12：头像上传

#### 步骤
1. 在"医生基础信息管理"页面
2. 点击头像上传的"选择文件"按钮
3. 选择一张图片
4. 填写其他信息
5. 点击"保存"

#### 预期结果
- ✅ 选择图片后预览显示
- ✅ 保存后头像保存成功
- ✅ 列表中显示头像（如果有头像列）

#### 测试点
- [ ] 可以选择图片
- [ ] 预览正常显示
- [ ] 头像保存成功

---

## 边界测试

### 测试13：日期范围边界

#### 测试用例
1. 开始日期 > 结束日期
2. 日期范围超过30天
3. 日期范围为1天
4. 选择过去的日期

#### 预期结果
- 开始日期 > 结束日期：提示错误
- 其他情况：正常处理

---

### 测试14：号源数量边界

#### 测试用例
1. 号源数量为0
2. 号源数量为负数
3. 号源数量为非常大的数（如9999）
4. 号源数量为小数

#### 预期结果
- 0：正常保存（表示不接受预约）
- 负数：输入框限制（min="0"）
- 大数：正常保存
- 小数：输入框限制（整数）

---

### 测试15：必填字段验证

#### 测试用例
1. 不填写医生姓名，直接保存
2. 不选择医生，直接查询号源
3. 不选择日期范围，直接查询号源

#### 预期结果
- 所有情况都应该有相应的提示

---

## 性能测试

### 测试16：大量数据

#### 测试用例
1. 添加50位医生
2. 为每位医生设置30天的号源
3. 查询号源列表

#### 预期结果
- 页面响应流畅
- 列表加载速度 < 2秒

---

## 兼容性测试

### 测试17：浏览器兼容性

#### 测试浏览器
- [ ] Chrome（推荐）
- [ ] Edge
- [ ] Firefox
- [ ] Safari

#### 测试点
- 登录功能
- 验证码显示
- 表单操作
- 菜单切换

---

## 测试报告模板

```
测试日期：2025-12-04
测试人员：[姓名]
测试环境：
  - 操作系统：macOS / Windows / Linux
  - 浏览器：Chrome 120
  - 后端版本：v2.0.0

测试结果：
  - 通过：[数量]
  - 失败：[数量]
  - 阻塞：[数量]

失败用例：
  1. [用例编号] - [失败原因]
  2. ...

建议：
  1. ...
  2. ...
```

---

## 常见问题排查

### 问题1：无法登录
- 检查用户名和密码是否正确
- 检查验证码是否正确（区分大小写）
- 清除浏览器缓存重试

### 问题2：查询号源为空
- 检查是否已设置号源
- 检查日期范围是否正确
- 检查是否选择了医生

### 问题3：保存失败
- 检查网络连接
- 检查后端服务是否运行
- 检查数据库连接是否正常
- 查看浏览器控制台错误信息

### 问题4：页面显示异常
- 清除浏览器缓存
- 刷新页面
- 检查浏览器版本

---

## 自动化测试（可选）

如需进行自动化测试，可以使用以下工具：
- Selenium WebDriver
- Puppeteer
- Cypress

示例测试脚本（Puppeteer）：
```javascript
const puppeteer = require('puppeteer');

(async () => {
  const browser = await puppeteer.launch();
  const page = await browser.newPage();
  
  // 访问登录页面
  await page.goto('http://localhost:4000/admin/login.html');
  
  // 输入用户名和密码
  await page.type('#username', 'admin');
  await page.type('#password', 'Aa121212');
  
  // 这里需要处理验证码...
  
  await browser.close();
})();
```

---

## 测试完成检查清单

- [ ] 所有功能测试通过
- [ ] 边界测试通过
- [ ] 性能测试通过
- [ ] 兼容性测试通过
- [ ] 文档已更新
- [ ] 测试报告已提交
